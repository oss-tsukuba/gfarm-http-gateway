<!DOCTYPE html>
<html>
<head>
    <title>Login / Logout</title>

<style>
table {
    width: 1000px;
    table-layout: fixed;
}
td {
    overflow-wrap: break-word; /* または word-wrap: break-word; */
    border: 1px solid black;
}
</style>

</head>
<body>
    <h1>Gfarm HTTP Gateway</h1>
    {% if access_token %}
        <h2> access_token </h2>
        <table><tr><td>{{ access_token }}</td></tr></table>

        <p> <a href="/c/me">Who am I (/me)</a> </p>
        <button id="whoami_btn">Who am I</button>
        <div id="whoami_out"></div>

        <p>
        <input type="text" id="ls_path" value="/tmp">
        <button id="ls_btn">ls -la</button>
        <table><tr><td><pre><div id="ls_out"></div></pre></td></tr></table>
        </p>

        <p> <a href="/logout">Logout</a> </p>
    {% else %}
        <p> <a href="/login">Login with Keycloak</a> </p>
    {% endif %}


<script>
  const whoamiButton = document.getElementById('whoami_btn');
  const whoamiOut = document.getElementById('whoami_out');

  whoamiButton.addEventListener('click', async () => {
     try {
        const response = await fetch('/c/me');
          if (!response.ok) {
            throw new Error(`HTTP error: ${response.status}`);
          }
          const text = await response.text();
          whoamiOut.textContent = text;
      } catch (error) {
         console.error('Error fetching data:', error);
         whoamiOut.textContent = error;
      }
  });

  const lsPath = document.getElementById('ls_path');
  const lsButton = document.getElementById('ls_btn');
  const lsOut = document.getElementById('ls_out');

  lsButton.addEventListener('click', async () => {
      const path = lsPath.value;

      if (!path) {
          outputDiv.textContent = "Input path";
          return;
      }

      try {
          let api_dir = "/d";
          let fullpath = api_dir + "/" + path + "?a=1";
          const response = await fetch(fullpath);
          if (!response.ok) {
              const errorText = await response.text();
              throw new Error(`HTTP error: ${response.status} - ${errorText}`);
          }
          //const data = await response.json();
          //lsOut.textContent = JSON.stringify(data, null, 2);
          const text = await response.text();
          lsOut.textContent = text;
      } catch (error) {
          console.error('Error fetching data:', error);
          lsOut.textContent = error;
      }
  });

</script>

</body>
</html>
